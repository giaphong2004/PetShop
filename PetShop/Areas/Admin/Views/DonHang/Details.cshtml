@model WebsiteBanHang.Data.DonHang

@{
    ViewBag.Title = "Chi tiết Đơn hàng #" + Model.ID;
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link href="~/Areas/Admin/Content/css/details.css" rel="stylesheet" />
}

<div class="mb-4">
    <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
    </a>
    <a href="@Url.Action("Edit", new { id = Model.ID })" class="btn btn-primary">
        <i class="fas fa-edit me-2"></i>Chỉnh sửa
    </a>
    <button onclick="window.print()" class="btn btn-success">
        <i class="fas fa-print me-2"></i>In đơn hàng
    </button>
</div>

<div class="order-details-card">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Đơn hàng <strong>#@Model.ID</strong></h2>
        @{
            var statusClass = "";
            switch (Model.TrangThai?.ToLower())
            {
                case "đã giao": statusClass = "status-dagiao"; break;
                case "đang giao": statusClass = "status-danggiao"; break;
                case "đang xử lý": statusClass = "status-dangxuly"; break;
                case "đã hủy": statusClass = "status-dahuy"; break;
                default: statusClass = "status-dangxuly"; break;
            }
        }
       
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <h5 class="section-title">Thông tin khách hàng</h5>
            <div class="info-row">
                <span class="info-label">Tên khách hàng:</span>
                <span>@(Model.KhachHang != null ? Model.KhachHang.TenKH : "N/A")</span>
            </div>
            <div class="info-row">
                <span class="info-label">Số điện thoại:</span>
                <span>@(Model.KhachHang != null ? Model.KhachHang.SDT : "N/A")</span>
            </div>
            <div class="info-row">
                <span class="info-label">Email:</span>
                <span>@(Model.KhachHang != null && !string.IsNullOrEmpty(Model.KhachHang.Email) ? Model.KhachHang.Email : "N/A")</span>
            </div>
            <div class="info-row">
                <span class="info-label">Địa chỉ giao hàng:</span>
                <span>@(Model.KhachHang != null ? Model.KhachHang.DiaChi : "N/A")</span>
            </div>
        </div>
        <div class="col-md-6">
            <h5 class="section-title">Thông tin đơn hàng</h5>
            <div class="info-row">
                <span class="info-label">Mã đơn hàng:</span>
                <span><strong>#@Model.ID</strong></span>
            </div>
            <div class="info-row">
                <span class="info-label">Ngày đặt:</span>
                <span>@(Model.NgayDat.HasValue ? Model.NgayDat.Value.ToString("dd/MM/yyyy HH:mm") : "N/A")</span>
            </div>
            <div class="info-row">
                <span class="info-label">Trạng thái:</span>
                <span class="status-tag @statusClass">@Model.TrangThai</span>
            </div>
        </div>
    </div>

    <h5 class="section-title">Chi tiết sản phẩm</h5>
    <div class="table-responsive">
        <table class="table table-bordered product-table">
            <thead>
                <tr>
                    <th>Sản phẩm</th>
                    <th class="text-center" style="width: 15%;">Số lượng</th>
                    <th class="text-end" style="width: 20%;">Đơn giá</th>
                    <th class="text-end" style="width: 20%;">Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @{
                    decimal tongTien = 0;
                }
                @if (Model.ChiTietDonHangs != null && Model.ChiTietDonHangs.Any())
                {
                    foreach (var item in Model.ChiTietDonHangs)
                    {
                        var thanhTien = (item.SoLuong ?? 0) * (item.DonGia ?? 0);
                        tongTien += thanhTien;
                        <tr>
                            <td>
                                <strong>@(item.SanPham != null ? item.SanPham.TenSP : "N/A")</strong>
                                <br />
                                <small class="text-muted">Mã SP: #@item.SanPhamID</small>
                            </td>
                            <td class="text-center">@item.SoLuong</td>
                            <td class="text-end">@item.DonGia.Value.ToString("N0") ₫</td>
                            <td class="text-end"><strong>@thanhTien.ToString("N0") ₫</strong></td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center text-muted">Không có sản phẩm</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="row justify-content-end">
        <div class="col-md-5">
            <div class="total-section">
                <div class="d-flex justify-content-between mb-2">
                    <span>Tạm tính:</span>
                    <span><strong>@tongTien.ToString("N0") ₫</strong></span>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <span>Phí vận chuyển:</span>
                    <span><strong>Miễn phí</strong></span>
                </div>
                <hr />
                <div class="d-flex justify-content-between">
                    <h5 class="mb-0"><strong>Tổng cộng:</strong></h5>
                    <h4 class="mb-0 text-danger"><strong>@tongTien.ToString("N0") ₫</strong></h4>
                </div>
            </div>
        </div>
    </div>
</div>
