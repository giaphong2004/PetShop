@model WebsiteBanHang.Data.DonHang

@{
    ViewBag.Title = "Chỉnh sửa Đơn hàng #" + Model.ID;
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link href="~/Areas/Admin/Content/css/chitietdonhang.css" rel="stylesheet" />
}

<div class="mb-4">
    <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
    </a>
</div>

<div class="edit-card">
    <h2 class="mb-4">Chỉnh sửa Đơn hàng <strong>#@Model.ID</strong></h2>

    @using (Html.BeginForm("Edit", "DonHang", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate" }))
    {
        @Html.AntiForgeryToken()
        @Html.Hidden("id", Model.ID)

        <div class="row">
            <div class="col-lg-6">
                <h5 class="section-title">Thông tin khách hàng</h5>
                
                <div class="mb-3">
                    <label class="form-label">Tên khách hàng</label>
                    <input type="text" class="form-control" 
                           value="@(Model.KhachHang != null ? Model.KhachHang.TenKH : "")" 
                           readonly disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label">Số điện thoại</label>
                    <input type="text" class="form-control" 
                           value="@(Model.KhachHang != null ? Model.KhachHang.SDT : "")" 
                           readonly disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" 
                           value="@(Model.KhachHang != null ? Model.KhachHang.Email : "")" 
                           readonly disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label">Địa chỉ giao hàng</label>
                    <textarea class="form-control" rows="3" readonly disabled>@(Model.KhachHang != null ? Model.KhachHang.DiaChi : "")</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label"><strong>Trạng thái đơn hàng</strong> <span class="text-danger">*</span></label>
                    @Html.DropDownList("TrangThai", ViewBag.StatusList as SelectList, new { @class = "form-select", required = "required" })
                </div>
            </div>

            <div class="col-lg-6">
                <h5 class="section-title">Chi tiết sản phẩm</h5>
                
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-sm table-bordered product-table">
                        <thead class="sticky-top">
                            <tr>
                                <th>Sản phẩm</th>
                                <th class="text-center" style="width: 20%;">Số lượng</th>
                                <th class="text-center" style="width: 25%;">Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                decimal tongTien = 0;
                            }
                            @if (Model.ChiTietDonHangs != null && Model.ChiTietDonHangs.Any())
                            {
                                foreach (var item in Model.ChiTietDonHangs)
                                {
                                    var thanhTien = (item.SoLuong ?? 0) * (item.DonGia ?? 0);
                                    tongTien += thanhTien;
                                    <tr>
                                        <td>
                                            <strong>@(item.SanPham != null ? item.SanPham.TenSP : "N/A")</strong>
                                            <br />
                                            <small class="text-muted">@item.DonGia.Value.ToString("N0") ₫/sp</small>
                                        </td>
                                        <td class="text-center">
                                            <strong>@item.SoLuong</strong>
                                        </td>
                                        <td class="text-center">
                                            <strong>@thanhTien.ToString("N0") ₫</strong>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>

                <div class="total-box">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tạm tính:</span>
                        <span><strong>@tongTien.ToString("N0") ₫</strong></span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Phí vận chuyển:</span>
                        <span><strong>Miễn phí</strong></span>
                    </div>
                    <hr />
                    <div class="d-flex justify-content-between">
                        <h5 class="mb-0"><strong>Tổng cộng:</strong></h5>
                        <h4 class="mb-0 text-danger"><strong>@tongTien.ToString("N0") ₫</strong></h4>
                    </div>
                </div>
            </div>
        </div>

        <hr class="my-4" />

        <div class="d-flex justify-content-end gap-2">
            <a href="@Url.Action("Index")" class="btn btn-secondary">
                <i class="fas fa-times me-2"></i>Hủy
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Lưu thay đổi
            </button>
        </div>
    }
</div>
